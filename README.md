# Concussion

[![bitHound Overalll Score](https://www.bithound.io/github/sadlerjw/concussion/badges/score.svg)](https://www.bithound.io/github/sadlerjw/concussion)

Concussion is a filesystem-based blogging engine inspired by [Camel]. It works in much the same way, populating the site from Markdown files found in the `posts` folder.

## Table of Contents
- [Running and Deploying](#running-and-deploying)
- [Caching](#caching)
- [Contents of the Posts Directory](#contents-of-the-posts-directory)
    + [Posts](#posts)
    + [Resources](#resources)
- [Customization](#customization)

## Running and Deploying

Clone the repo, use `npm install` to pull down all the dependencies, and run `gulp` to start Concussion running at [http://localhost:3000/].

My site, [sadlerjw.com], is deployed to Heroku. Since concussion populates the website from Markdown files stored on the filesystem, and Heroku has an [ephemeral filesystem][ephemeral], this means that posts need to be checked into the repository that you deploy to Heroku. This is nice for having a history of changes, and works well with Heroku's [Dropbox integration][heroku-dropbox], which syncs your most recent Heroku deploy to Dropbox. This means that if you're not at a computer with `git` (maybe you're on your iPad or something) you can edit and add posts in Dropbox, and then log into Heroku to deploy from Dropbox.

## Caching

Concussion caches all posts on an as-needed basis. Posts are never evicted from the cache, which means that once the cache is warmed, Concussion will need to be restarted in order to see changes. This works fine in the case of a Heroku deployment, since any push to Heroku automatically restarts the app.

## Contents of the Posts Directory

### Posts

Posts are stored in `.md` files in the `posts` directory and its subdirectories. Posts that appear in the RSS feed and the home page must be in a `/posts/yyyy/mm/dd/my-post.md` folder heirarchy. *All* posts appear on the Archive page. Each post's URL matches its location under the `posts` directory, with the file extension removed. (For example `/posts/about.md` can be reached at `http://example.com/about` and `/posts/2015/11/19/my-post.md` will be at `http://example.com/2015/11/19/my-post`.)

Posts must not have `.` in their path, except for in the `.md` file extension.

Items in the `public` directory, `/archive`, and `/rss.xml` get precedence over posts. For example, a post located at `/posts/archive.md` will not be accessible, since navigating to `/archive` goes to the Posts Archive instead.

#### File Format

Posts begin with front matter, represented by a block of [YAML] wrapped by `---` before and after. The rest of the file is treated as the body of the post, and passed through a Markdown to HTML converter.

For example:

```
---
title: Lorem Ipsum is Fun
date: 2015-08-22T10:55:00Z
---

This is an example post.

It is composed of *text* formatted via `Markdown`.
```

produces a post with the title "Lorem Ipsum is Fun", a date of October 22, 2015, and the following HTML as the post body:

```html
<p>This is an example post.</p>

<p>It is composed of <em>text</em> formatted via <code>Markdown</code>.</p>
```

##### Front Matter

The front matter can contain any valid YAML. Properties unrecognized by Concussion will be made available in the `Article` object's `metadata` property but will be otherwise ignored.

Concussion currently recognizes the following properties:

- `title` - string, **required**
- `subtitle` - string - if set, will appear before under the title
- `date` - string - must be in [ISO-8601] format
- `published` - boolean - whether the article should appear on the website. Useful for checking in partially-finished posts. Defaults to `true`
- `link` - URL - if set, designates the post as a link-post. This link will appear directly under the title of the post on the website. The RSS feed will link directly to this URL, rather than the usual post URL. The link to the original post is always at the bottom of each RSS item as "Permalink"

### Resources

All files present in the `posts` directory can be accessed directly at their path, relative to the `posts` directory. For example, `/posts/2015/01/24/picture.png` can be accessed at `http://example.com/2015/01/24/picture.png`. This also applies to posts, so for a post located at `http://example.com/about`, you can view the post source at by adding the `.md` extension: `http://example.com/about.md`.

## Customization

Concussion uses [Handlebars] to generate the site HTML, which are located in [views](views). The main site layout is located in [views/layouts/main.handlebars](views/layouts/main.handlebars), which links to [public/css/base.css](public/css/base.css), which is generated by Gulp from [public/css/base.less](public/css/base.less).

The appearance of posts, including rendering post metadata, is defined in [views/partials/article-listing.handlebars](views/partials/article-listing.handlebars). All metadata from the post's YAML block is available in the `metadata` object. For instance, a link-post's link is rendered by:

```handlebars
{{#if metadata.link}}
    <a class="linkpost" href="{{metadata.link}}">{{metadata.link}}</a>
{{/if}}
```

[http://localhost:3000/]: http://localhost:3000/
[Camel]: https://github.com/cliss/camel
[sadlerjw.com]: http://www.sadlerjw.com
[ISO-8601]: https://xkcd.com/1179/
[ephemeral]: https://devcenter.heroku.com/articles/dynos#ephemeral-filesystem
[heroku-dropbox]: https://blog.heroku.com/archives/2014/11/19/announcing_beta_dropbox_sync
[YAML]: http://yaml.org
[Handlebars]: http://handlebarsjs.com
